@startuml
actor ユーザー
boundary フォーム
control フォームコントローラ
entity ドキュメント
database データベース

activate ユーザー

ユーザー -> フォーム: フォームを開く
activate フォーム

フォーム -> フォームコントローラ: ドキュメントフォームを生成
activate フォームコントローラ

alt ドキュメントにエラーがある
  フォームコントローラ -> フォーム: エラーを表示
else
  フォームコントローラ -> フォーム: フォームを表示
end

deactivate フォームコントローラ

alt ドキュメントにエラーがある
  フォーム -> ユーザー: エラーメッセージを表示
else
  フォーム -> フォームコントローラ: フォームデータを送信
  activate フォームコントローラ

  フォームコントローラ -> ドキュメント: ドキュメントデータを作成
  activate ドキュメント

  alt ドキュメントの検証が成功
    ドキュメント -> データベース: ドキュメントデータを保存
    deactivate ドキュメント

    フォームコントローラ -> フォーム: 成功メッセージを表示
  else
    ドキュメント -> ドキュメント: エラーメッセージを生成
    deactivate ドキュメント

    フォームコントローラ -> フォーム: エラーメッセージを表示
  end

  deactivate フォームコントローラ
end

deactivate フォーム
deactivate ユーザー
@enduml
